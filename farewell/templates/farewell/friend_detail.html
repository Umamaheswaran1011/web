{% extends 'farewell/base.html' %}
{% load static %}

{% block content %}
<div>
    <div class="scrapbook-page">
        <!-- ===== Profile Section ===== -->
        <div class="profile-section animate-on-scroll fade-in">
            <div class="left-col">
                <div class="polaroid-frame">
                    {% if friend.photo %}
                    <img src="{{ friend.photo.url }}" alt="{{ friend.name }}" loading="lazy">
                    {% else %}
                    <img src="https://via.placeholder.com/600x800" alt="{{ friend.name }}" loading="lazy">
                    {% endif %}
                    <div class="polaroid-caption">{{ friend.name }}</div>
                </div>
            </div>

            <div class="right-col">
                <h2 class="detail-name">{{ friend.name }}</h2>
                {% if friend.nickname %}
                <p class="detail-nickname">"{{ friend.nickname }}"</p>
                {% endif %}

                {% if friend.future_goal %}
                <div class="detail-label">Future Goal</div>
                <div class="detail-text">
                    üöÄ {{ friend.future_goal }}
                </div>
                {% endif %}

                {% if friend.memory_text %}
                <div class="memory-note-container">
                    <div class="memory-note-label">üìù Memory</div>
                    <div class="memory-note">
                        <span class="pen-icon">‚úèÔ∏è</span>
                        <div class="memory-note-text">{{ friend.memory_text }}</div>
                    </div>
                </div>
                {% endif %}

                <div class="action-buttons">
                    <a href="{% url 'farewell:edit_friend' friend.pk %}" class="btn-edit">‚úèÔ∏è Edit Info</a>

                    <form action="{% url 'farewell:delete_friend' friend.pk %}" method="post"
                        onsubmit="return confirm('Are you sure you want to delete this friend?');">
                        {% csrf_token %}
                        <button type="submit" class="btn-delete" title="Delete Friend"
                            style="margin: 0; font-size: 1.5rem;">üóëÔ∏è</button>
                    </form>
                </div>

                <a href="{% url 'farewell:index' %}" class="back-link">‚Üê Back to Squad</a>
            </div>
        </div>

        <!-- ===== ORKUT SCRAPBOOK SECTION ===== -->
        <div class="scrapbook-section animate-on-scroll slide-up">
            <h2 class="scrapbook-title">üìí Scrapbook</h2>
            <div class="doodle-divider">‚ú¶ ~ ‚òÖ ~ ‚ú¶ ~ ‚òÖ ~ ‚ú¶</div>

            <div class="scraps-layout">
                <!-- Messages as Post-it Scraps -->
                <div class="scraps-messages">
                    {% for msg in slam_messages %}
                    <div class="scrap-note">
                        <div class="scrap-sender">{{ msg.sender_name }}</div>
                        <div class="scrap-text">{{ msg.message }}</div>
                        <div class="scrap-time">{{ msg.created_at|date:"M j, Y ¬∑ g:i A" }}</div>
                    </div>
                    {% empty %}
                    <div class="scraps-empty">
                        No scraps yet. Be the first to write something! ‚úèÔ∏è
                    </div>
                    {% endfor %}
                </div>

                <!-- Scrapbook Form -->
                <div class="scrap-form-container">
                    <div class="scrap-form-title">‚úçÔ∏è Write a scrap for {{ friend.name }}</div>
                    <form method="post">
                        {% csrf_token %}

                        {% for field in slam_form %}
                        <div class="form-group">
                            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                            {{ field }}
                            {% for error in field.errors %}
                            <div style="color: #c0392b; font-size: 0.85em; margin-top: 5px;">{{ error }}</div>
                            {% endfor %}
                        </div>
                        {% endfor %}

                        <button type="submit" class="btn-scrap-submit">üìå Pin Scrap</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}