{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }}</title>
    <meta name="description"
        content="{% block meta_description %}A farewell tribute to the Anti-Gravity Squad - Batch 2026{% endblock %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}?v=5.0">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Caveat:wght@400;500;600;700&family=Patrick+Hand&family=Special+Elite&family=Indie+Flower&family=Reenie+Beanie&display=swap">
    <!-- ===== Vintage Cassette Player CSS ===== -->
    <style>
        /* === Cassette Player Fixed Container === */
        .cassette-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            transition: transform 0.3s ease;
        }

        .cassette-player:hover {
            transform: scale(1.03);
        }

        /* === Cassette Body === */
        .cassette-body {
            width: 220px;
            height: 140px;
            background: linear-gradient(180deg, #d4935a 0%, #c47d3e 30%, #b5692e 100%);
            border-radius: 10px 10px 6px 6px;
            position: relative;
            box-shadow:
                0 4px 14px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -2px 4px rgba(0, 0, 0, 0.15);
            border: 2px solid #8b5a2b;
            overflow: hidden;
        }

        /* Plastic texture overlay */
        .cassette-body::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                repeating-linear-gradient(0deg,
                    transparent 0px,
                    transparent 2px,
                    rgba(255, 255, 255, 0.03) 2px,
                    rgba(255, 255, 255, 0.03) 3px);
            pointer-events: none;
            border-radius: 8px;
        }

        /* === Top screw holes === */
        .cassette-screw {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #4a3520 40%, #6b4c30 60%, #8b5a2b 100%);
            border-radius: 50%;
            top: 6px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.4);
        }

        .cassette-screw.left {
            left: 10px;
        }

        .cassette-screw.right {
            right: 10px;
        }

        /* === Label Area === */
        .cassette-label {
            position: absolute;
            top: 18px;
            left: 20px;
            right: 20px;
            height: 38px;
            background: linear-gradient(180deg, #faf3e0 0%, #f0e6cc 100%);
            border-radius: 3px;
            border: 1px solid #d4a574;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .cassette-label-title {
            font-family: 'Special Elite', monospace;
            font-size: 0.6rem;
            color: #8a7a6a;
            letter-spacing: 2px;
            text-transform: uppercase;
            line-height: 1;
        }

        .cassette-label-name {
            font-family: 'Caveat', cursive;
            font-size: 0.9rem;
            color: #2c1810;
            font-weight: 700;
            line-height: 1.2;
        }

        /* === Tape Window (dark area with reels) === */
        .cassette-window {
            position: absolute;
            top: 62px;
            left: 25px;
            right: 25px;
            height: 42px;
            background: linear-gradient(180deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%);
            border-radius: 4px;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 15px;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.5);
        }

        /* Tape film strip between reels */
        .cassette-window::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 30px;
            right: 30px;
            height: 6px;
            transform: translateY(-50%);
            background: #1a0e06;
            border-top: 1px solid rgba(80, 50, 20, 0.4);
            border-bottom: 1px solid rgba(80, 50, 20, 0.4);
            z-index: 0;
        }

        /* === Reels (circles) === */
        .cassette-reel {
            width: 28px;
            height: 28px;
            background: radial-gradient(circle, #faf3e0 20%, #d4a574 22%, #b5895a 60%, #8b5a2b 100%);
            border-radius: 50%;
            position: relative;
            z-index: 1;
            border: 2px solid #5a3a1a;
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.4);
        }

        /* Reel spokes */
        .cassette-reel::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 2px;
            background: #3d2510;
            transform: translate(-50%, -50%);
        }

        .cassette-reel::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 2px;
            height: 20px;
            background: #3d2510;
            transform: translate(-50%, -50%);
        }

        /* Center dot of reel */
        .reel-center {
            width: 6px;
            height: 6px;
            background: #2c1810;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        }

        /* === Spin Animation === */
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .cassette-reel.playing {
            animation: spin 1.5s linear infinite;
        }

        /* === Bottom ridge details === */
        .cassette-bottom {
            position: absolute;
            bottom: 4px;
            left: 30px;
            right: 30px;
            height: 3px;
            background: repeating-linear-gradient(90deg,
                    #8b5a2b 0px, #8b5a2b 4px,
                    #a06a3a 4px, #a06a3a 8px);
            border-radius: 2px;
        }

        /* === Controls === */
        .cassette-controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
        }

        .cassette-btn {
            font-family: 'Patrick Hand', cursive;
            background: rgba(244, 228, 188, 0.85);
            border: 1px dashed #b5895a;
            color: #2c1810;
            padding: 4px 14px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.25s ease;
            box-shadow: 1px 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .cassette-btn:hover {
            background: #d4a574;
            transform: translateY(-1px) rotate(-1deg);
            box-shadow: 2px 3px 8px rgba(0, 0, 0, 0.15);
        }

        .cassette-btn.active {
            background: #d4a574;
            border-style: solid;
        }

        /* === Toggle to collapse/expand === */
        .cassette-toggle {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 24px;
            height: 24px;
            background: #faf3e0;
            border: 1px solid #d4a574;
            border-radius: 50%;
            font-size: 0.7rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 1px 2px 4px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s ease;
            z-index: 10;
            padding: 0;
            font-family: sans-serif;
        }

        .cassette-toggle:hover {
            transform: scale(1.15);
        }

        .cassette-player.collapsed .cassette-body,
        .cassette-player.collapsed .cassette-controls {
            display: none;
        }

        .cassette-player.collapsed {
            bottom: 15px;
            right: 15px;
        }

        .cassette-collapsed-icon {
            display: none;
            font-family: 'Special Elite', monospace;
            font-size: 0.75rem;
            color: #5a4a3a;
            background: rgba(244, 228, 188, 0.9);
            padding: 5px 10px;
            border: 1px dashed #b5895a;
            border-radius: 3px;
            cursor: pointer;
            box-shadow: 1px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .cassette-player.collapsed .cassette-collapsed-icon {
            display: block;
        }

        .cassette-player.collapsed .cassette-toggle {
            display: none;
        }

        /* === Track Display ‚Äî Retro LCD === */
        .cassette-track-display {
            text-align: center;
            margin-top: 5px;
        }

        .track-lcd {
            display: inline-block;
            font-family: 'Special Elite', monospace;
            font-size: 0.7rem;
            color: #3d5a1e;
            background: linear-gradient(180deg, #c8d8a0 0%, #b5c88a 100%);
            padding: 3px 12px;
            border-radius: 3px;
            border: 1px solid #9aad6a;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            box-shadow:
                inset 0 1px 2px rgba(0, 0, 0, 0.1),
                0 1px 2px rgba(0, 0, 0, 0.08);
        }

        /* Mobile: smaller cassette */
        @media (max-width: 480px) {
            .cassette-body {
                width: 180px;
                height: 115px;
            }

            .cassette-label {
                top: 14px;
                left: 16px;
                right: 16px;
                height: 32px;
            }

            .cassette-window {
                top: 52px;
                left: 20px;
                right: 20px;
                height: 34px;
            }

            .cassette-reel {
                width: 22px;
                height: 22px;
            }

            .cassette-player {
                bottom: 12px;
                right: 12px;
            }
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- ===== Toast Notification Container ===== -->
    <div id="toast-container"></div>

    <!-- ===== Loading Splash ===== -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-content">
            <div class="splash-title">The Anti-Gravity Squad</div>
            <div class="splash-subtitle">Batch 2026 ¬∑ Forever in Our Hearts</div>
            <div class="splash-loader"></div>
        </div>
    </div>

    <!-- ===== Persistent Navigation ===== -->
    <nav class="scrapbook-nav" id="mainNav">
        <div class="nav-inner">
            <a href="{% url 'farewell:index' %}" class="nav-brand">üöÄ Anti-Gravity Squad</a>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
                <span></span><span></span><span></span>
            </button>
            <div class="nav-links" id="navLinks">
                <a href="{% url 'farewell:index' %}"
                    class="nav-link {% if request.resolver_match.url_name == 'index' %}active{% endif %}">üè† Home</a>
                <a href="{% url 'farewell:gallery' %}"
                    class="nav-link {% if request.resolver_match.url_name == 'gallery' or request.resolver_match.url_name == 'event_detail' %}active{% endif %}">üì∏
                    Gallery</a>
                <a href="{% url 'farewell:timeline' %}"
                    class="nav-link {% if request.resolver_match.url_name == 'timeline' %}active{% endif %}">üéì
                    Timeline</a>
                <a href="{% url 'farewell:awards' %}"
                    class="nav-link {% if request.resolver_match.url_name == 'awards' %}active{% endif %}">üèÜ Awards</a>
                <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">üåô</button>
            </div>
        </div>
    </nav>

    <!-- ===== Header ===== -->
    <header>
        <h1 class="animate-on-scroll fade-in">{{ page_title }}</h1>
        {% block header_extra %}{% endblock %}
    </header>

    <!-- ===== Main Content ===== -->
    {% block content %}{% endblock %}

    <!-- ===== Vintage Cassette Music Player ===== -->
    <div class="cassette-player" id="cassettePlayer">
        <button class="cassette-toggle" id="cassetteToggle" title="Minimize player">‚úï</button>
        <div class="cassette-collapsed-icon" id="cassetteExpand" title="Open music player">üéµ Music</div>
        <div class="cassette-body">
            <div class="cassette-screw left"></div>
            <div class="cassette-screw right"></div>
            <div class="cassette-label">
                <span class="cassette-label-title">Side A</span>
                <span class="cassette-label-name">Batch 2026 MixTape</span>
            </div>
            <div class="cassette-window">
                <div class="cassette-reel" id="reelLeft">
                    <div class="reel-center"></div>
                </div>
                <div class="cassette-reel" id="reelRight">
                    <div class="reel-center"></div>
                </div>
            </div>
            <div class="cassette-bottom"></div>
        </div>
        <div class="cassette-controls">
            <button class="cassette-btn" id="btnPlay">‚ñ∂Ô∏è Play</button>
            <button class="cassette-btn" id="btnPause">‚è∏Ô∏è Pause</button>
        </div>
        <div class="cassette-track-display">
            <span class="track-lcd" id="trackLcd">Track: 1 / 3</span>
        </div>
        <!-- Audio element ‚Äî src set by JS playlist -->
        <audio id="bg-music"></audio>
    </div>

    <!-- ===== Footer ===== -->
    <footer>
        <p>&copy; 2026 The Anti-Gravity Squad | Forever in Our Hearts ‚ù§Ô∏è</p>
    </footer>

    {% block extra_js %}{% endblock %}

    <!-- ===== Global JS: Splash, Nav, Animations, Theme, Toast ===== -->
    <script>
        // === Splash Screen ===
        window.addEventListener('load', function () {
            const splash = document.getElementById('splashScreen');
            if (splash) {
                setTimeout(function () {
                    splash.classList.add('splash-hide');
                    setTimeout(function () { splash.style.display = 'none'; }, 600);
                }, 800);
            }
        });

        // === Mobile Nav Toggle ===
        const navToggle = document.getElementById('navToggle');
        const navLinks = document.getElementById('navLinks');
        if (navToggle) {
            navToggle.addEventListener('click', function () {
                navLinks.classList.toggle('show');
                navToggle.classList.toggle('active');
            });
        }

        // === Scroll Animations ===
        function initScrollAnimations() {
            const elements = document.querySelectorAll('.animate-on-scroll');
            const observer = new IntersectionObserver(function (entries) {
                entries.forEach(function (entry) {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animated');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
            elements.forEach(function (el) { observer.observe(el); });
        }
        document.addEventListener('DOMContentLoaded', initScrollAnimations);

        // === Dark/Light Theme Toggle ===
        const themeToggle = document.getElementById('themeToggle');
        function applyTheme(dark) {
            document.body.classList.toggle('dark-theme', dark);
            if (themeToggle) themeToggle.textContent = dark ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', dark ? 'dark' : 'light');
        }
        // Load saved preference
        applyTheme(localStorage.getItem('theme') === 'dark');
        if (themeToggle) {
            themeToggle.addEventListener('click', function () {
                applyTheme(!document.body.classList.contains('dark-theme'));
            });
        }

        // === Toast Notifications ===
        function showToast(message, type) {
            type = type || 'success';
            const container = document.getElementById('toast-container');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = 'toast toast-' + type;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(function () { toast.classList.add('toast-show'); }, 10);
            setTimeout(function () {
                toast.classList.remove('toast-show');
                setTimeout(function () { toast.remove(); }, 400);
            }, 3000);
        }

        // Show toast from URL params (after redirect)
        (function () {
            const params = new URLSearchParams(window.location.search);
            const msg = params.get('msg');
            if (msg) {
                showToast(decodeURIComponent(msg));
                // Clean URL
                const url = new URL(window.location);
                url.searchParams.delete('msg');
                window.history.replaceState({}, '', url);
            }
        })();

        // === Cassette Music Player ‚Äî Playlist Mode ===
        (function () {
            const audio = document.getElementById('bg-music');
            const btnPlay = document.getElementById('btnPlay');
            const btnPause = document.getElementById('btnPause');
            const reelLeft = document.getElementById('reelLeft');
            const reelRight = document.getElementById('reelRight');
            const cassetteToggle = document.getElementById('cassetteToggle');
            const cassetteExpand = document.getElementById('cassetteExpand');
            const cassettePlayer = document.getElementById('cassettePlayer');
            const trackLcd = document.getElementById('trackLcd');

            // Playlist ‚Äî update these paths to your actual static mp3 files
            const playlist = [
                '/static/music/song1.mp3',
                '/static/music/song2.mp3',
                '/static/music/song3.mp3'
            ];
            var currentIndex = 0;

            if (audio) audio.volume = 0.4;

            function updateTrackDisplay() {
                if (trackLcd) {
                    trackLcd.textContent = 'Track: ' + (currentIndex + 1) + ' / ' + playlist.length;
                }
            }

            function loadTrack(index) {
                if (!audio || !playlist.length) return;
                audio.src = playlist[index];
                audio.load();
                updateTrackDisplay();
            }

            function startPlaying() {
                if (!audio) return;
                // If no src yet, load the current track
                if (!audio.src || audio.src === window.location.href) {
                    loadTrack(currentIndex);
                }
                audio.play().then(function () {
                    reelLeft.classList.add('playing');
                    reelRight.classList.add('playing');
                    btnPlay.classList.add('active');
                    btnPause.classList.remove('active');
                }).catch(function () {
                    // Browser blocked autoplay ‚Äî user needs to interact first
                });
            }

            function stopPlaying() {
                if (!audio) return;
                audio.pause();
                reelLeft.classList.remove('playing');
                reelRight.classList.remove('playing');
                btnPause.classList.add('active');
                btnPlay.classList.remove('active');
            }

            // Auto-advance to next song when current one ends
            if (audio) {
                audio.addEventListener('ended', function () {
                    currentIndex = (currentIndex + 1) % playlist.length;
                    loadTrack(currentIndex);
                    audio.play().then(function () {
                        reelLeft.classList.add('playing');
                        reelRight.classList.add('playing');
                    }).catch(function () { });
                });
            }

            if (btnPlay) btnPlay.addEventListener('click', startPlaying);
            if (btnPause) btnPause.addEventListener('click', stopPlaying);

            // Collapse / Expand toggle
            if (cassetteToggle) {
                cassetteToggle.addEventListener('click', function () {
                    cassettePlayer.classList.add('collapsed');
                });
            }
            if (cassetteExpand) {
                cassetteExpand.addEventListener('click', function () {
                    cassettePlayer.classList.remove('collapsed');
                });
            }

            // Initialize display
            updateTrackDisplay();
        })();
    </script>
</body>

</html>